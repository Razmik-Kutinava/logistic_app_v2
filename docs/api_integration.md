# API и интеграции

## Внешние интеграции

### Телефонные звонки

Используется пакет `url_launcher` для инициации звонков.

```dart
void _callPhone() async {
  final uri = Uri(scheme: 'tel', path: widget.order.clientPhone);
  if (await canLaunchUrl(uri)) {
    await launchUrl(uri);
  }
}
```

**Особенности:**

- Прямой вызов телефонного приложения
- Счетчик количества звонков клиенту
- Автоматическое определение телефонного номера из заказа

### Карты и навигация

Интеграция с Google Maps для открытия адреса доставки.

```dart
void _openMap() async {
  final query = Uri.encodeComponent(widget.order.address);
  final uri = Uri.parse('https://maps.google.com/?q=$query');
  if (await canLaunchUrl(uri)) {
    await launchUrl(uri);
  }
}
```

**Функционал:**

- Открытие адреса в Google Maps
- Автоматическая навигация к клиенту
- Поддержка различных картографических сервисов

## Планируемые интеграции

### Backend API

**Структура взаимодействия:**

- PHP backend для управления заказами
- REST API для CRUD операций
- JWT авторизация водителей

**Основные эндпоинты:**

POST /api/auth/login - авторизация водителя
GET /api/orders - получение списка заказов
PUT /api/orders/{id}/status - изменение статуса заказа
POST /api/orders/{id}/refund - запрос на возврат

### Push-уведомления

**Сценарии использования:**

- Новый заказ назначен водителю
- Клиент запросил возврат
- Изменение времени доставки
- Системные уведомления

**Реализация:**

- Firebase Cloud Messaging (FCM)
- Локальные уведомления для офлайн режима

### QR-код сканирование

**Функционал:**

- Сканирование QR-кода товара на складе
- Автоматическое добавление заказа в список
- Валидация корректности товара

```dart
void handleQRScan(String qrData) {
  final newOrder = OrderModel(
    id: qrData,
    // ... создание заказа на основе QR
  );
  setState(() {
    orders.add(newOrder);
  });
}
```

## Безопасность

### Локальная валидация

- PIN-коды для завершения возвратов
- Валидация номеров телефонов
- Проверка корректности данных заказа

### Шифрование данных

**Планируемые меры:**

- Хэширование паролей водителей
- Шифрование персональных данных клиентов
- Защищенное хранение токенов авторизации

## Офлайн режим

### Локальное хранение

**Технологии:**

- SQLite для локальной БД
- Hive для кэширования
- SharedPreferences для настроек

**Синхронизация:**

- Автоматическая отправка при восстановлении интернета
- Очередь изменений статусов
- Конфликт-резолюция при расхождениях

## Производительность

### Оптимизации

- Ленивая загрузка заказов
- Кэширование изображений товаров
- Пагинация списков заказов
- Оптимизация запросов к API
